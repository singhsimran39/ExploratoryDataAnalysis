Lesson 5
========================================================

### Multivariate Data
Notes: Here we will do Data Analysis using not 2 but more variables.

***

###Load Data and packages
```{r Prep work}
library(ggplot2)
library(tidyr)
library(dplyr)
library(knitr)
library(reshape2)
pf <- read.csv("pseudo_facebook.tsv", sep = "\t")
```


### Third Qualitative Variable
Notes: Here we plot a boxplot for age by gender and also show the mean value for each group.

```{r Third Qualitative Variable - 1}
ggplot(aes(x = gender, y = age), data = subset(pf, !is.na(gender))) + 
  geom_boxplot() +
  geom_point(stat = "summary", fun.y = mean, shape = 3) +
  scale_y_continuous(breaks = seq(0, 113, 10))
```

Notes: Here we plot the median friend count for each gender
```{r Third Qualitative Variable - 2}
ggplot(aes(x = age, y = friend_count), 
                            data = subset(pf, !is.na(pf$gender))) +
  geom_line(aes(colour = gender), stat = "summary", fun.y = median)
```

Notes: Here we create a new data frame which has the mean and median friend count grouped by age and gender
```{r Third Qualitative Variable - 3}
pf.fc_by_age_gender <- pf %>%
  filter(!is.na(pf$gender)) %>% 
  group_by(age, gender) %>% 
  summarise(mean_friend_count = mean(friend_count),
            median_friend_count = median(friend_count),
            n = n()) %>% 
  ungroup() %>% 
  arrange(age)
```

***

### Plotting Conditional Summaries
Notes:Here we plot median friend count using the new data frame that we just created above

```{r Plotting Conditional Summaries}
ggplot(aes(y = median_friend_count, x = age, colour = gender),
       data = pf.fc_by_age_gender) +
  geom_line()
```

***

### Reshaping Data
Notes: Now we use the spread function of the tidyr package to change the columns of a our data frame.
```{r rehape using dplyr}
medianUsingDplyr <- pf.fc_by_age_gender[, c(1, 2, 4)] %>% 
  spread(gender, median_friend_count)
```

Notes: Next we will use the reshape2 package to change the data from long to wide format
```{r reshape using reshape2}
medianUsingReshape <- dcast(pf.fc_by_age_gender, age ~ gender, value.var = "median_friend_count")
```

### Wide and Long Format
Notes: The wide format of the data contains columns for different categorical variables. The long format of the data has one columnn for multiple variable values.

***

### Ratio Plot
Notes: Using the long dataframe that we created above we plot the ratio of median friend count for females and males. We also plot a horizontal line with the y intercept as 1

```{r Ratio Plot}
ggplot(aes(x = age, y = female/male), data = medianUsingReshape) +
  geom_line() +
  geom_hline(yintercept = 1, lty = 2, colour = "orange") +
  scale_y_continuous(breaks = seq(0, 3, .2)) +
  scale_x_continuous(breaks = seq(13, 120, 10))
```

***

### Third Quantitative Variable
Notes: We will add a variable called year_joined to the data frame.

```{r Third Quantitative Variable}
pf$year_joined <- floor(2014 - pf$tenure/365)

summary(pf$year_joined)
table(pf$year_joined)
```

***

### Cut a Variable
Notes: We add another variable year joined.bucket to the data frame. This variable bins together the year_joined column in different buckets.

```{r Cut a Variable}
pf$year_joined.bucket <- cut(pf$year_joined, breaks = c(2004, 2009, 2011, 2012, 2014))

table(pf$year_joined.bucket, useNA = "ifany")
```

***

### Plotting it All Together
Notes:We now plot the median friend count vs age for each of the different year_joined.bucket bins.

```{r Plotting it All Together}
ggplot(aes(x = age, y = friend_count), 
       data = subset(pf, !is.na(pf$year_joined.bucket))) + 
  geom_line(aes(colour = year_joined.bucket), stat = "summary", fun.y = median) +
  scale_y_continuous(breaks = seq(0, 2000, 100)) +
  scale_x_continuous(breaks = seq(13, 120, 10))
```

***

### Plot the Grand Mean
Notes:Plot showing friend count vs age for each of the different year joined bucket bins.

```{r Plot the Grand Mean}
ggplot(aes(x = age, y = friend_count), 
       data = subset(pf, !is.na(pf$year_joined.bucket))) +
  geom_line(aes(colour = year_joined.bucket), stat = "summary", 
            fun.y = mean) +
  geom_line(stat = "summary", fun.y = mean, lty = 2) +
  scale_y_continuous(breaks = seq(0, 2000, 100)) +
  scale_x_continuous(breaks = seq(13, 120, 5))
```

***

### Friending Rate
Notes:Calculating the friend count for the number of days active on facebook excluding the tenure of 0 days.

```{r Friending Rate}
with(subset(pf, pf$tenure > 0), summary(friend_count / tenure))
```

What is the median friend rate? - 0.2205

What is the maximum friend rate? - 417
***

### Friendships Initiated
Notes:Below is a plot that shows friendsjhips initiated by tenure

```{r Friendships Initiated}
pf %>% 
  filter(tenure > 0) %>% 
  ggplot(aes(x = tenure, y = friendships_initiated / tenure)) +
  geom_line(aes(colour = year_joined.bucket), stat = "summary", fun.y = mean) +
  scale_y_continuous(breaks = seq(0, 10, .5)) +
  scale_x_continuous(breaks = seq(0, 3200, 200))
```

***

### Bias-Variance Tradeoff Revisited
Notes:Here we plot the friend rate vs tenure for different bin widths. Finally we add a smoothner to the plot.

```{r Bias-Variance Tradeoff Revisited}

ggplot(aes(x = tenure, y = friendships_initiated / tenure),
       data = subset(pf, tenure >= 1)) +
  geom_line(aes(color = year_joined.bucket),
            stat = 'summary',
            fun.y = mean)

ggplot(aes(x = 7 * round(tenure / 7), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

ggplot(aes(x = 30 * round(tenure / 30), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

ggplot(aes(x = 90 * round(tenure / 90), y = friendships_initiated / tenure),
       data = subset(pf, tenure > 0)) +
  geom_line(aes(color = year_joined.bucket),
            stat = "summary",
            fun.y = mean)

ggplot(aes(x = tenure, y = friendships_initiated / tenure), 
       data = subset(pf, pf$tenure > 0)) +
  stat_smooth(aes(colour = year_joined.bucket))
```

***
### Introducing the Yogurt Data Set
Notes:Load the data and convert id variable into a factor

```{r Load Yogurt}
yo <- read.csv("yogurt.csv")
yo$id <- as.factor(yo$id)
```

***

### Histograms Revisited
Notes:Lots of gaps in the histogram plot. Most of the yogurt bought is in the 65-70 price range.

```{r Histograms Revisited}
ggplot(aes(x = price), data = yo) +
  geom_histogram(binwidth = 1, colour = "black", fill = "orange") + 
  scale_x_continuous(breaks = seq(0, 75, 5)) +
  scale_y_continuous(breaks = seq(0, 800, 50))
```

***

### Number of Purchases
Notes:We add a column to the data frame. This new column contains the sum of all yogurt purchases for an observation.

```{r Number of Purchases}
yo <- transform(yo, all.purchases = strawberry + blueberry + pina.colada + plain + mixed.berry)
```

***

### Prices over Time
Notes:We create a scatter plot of price vs time and see that price of the yogurt bought increases over time

```{r Prices over Time}
ggplot(aes(x = time, y = price), data = yo) +
  geom_jitter(alpha = 1/20, colour = "orange")
```

***

### Sampling Observations
Notes:It is often useful to work with a sample of the data set to get a better feel of the general pattern of the data.

***

### Looking at Samples of Households

```{r Looking at Sample of Households}
set.seed(77)
sample.ids <- sample(levels(yo$id), 16)

ggplot(aes(x = time, y = price), data = subset(yo, id %in% sample.ids)) +
  geom_point(aes(size = all.purchases), pch = 21, col = "black", fill = "orange") +
  geom_line() +
  facet_wrap( ~ id)
```
Above we have randomly selected 16 different ids from the data set. Before this we had made id as a factor because the id variable shows the different purchases of the same buyer. 
Next we have plotted the price vs time scatter plot for the selected 16 ids and faceted over ids. Since we have used the id variable as a factor therefore we can facet the plot over id. We have also mapped all.purchases to size in the aesthetics of the geom point. From this we can see that the bigger the size of the point  more the yogurt was bought by that id. For example for id 2124545 starting from the begining the buyer bought 2 yogurts then 2, then 3, then 1 and so on.
***

### The Limits of Cross Sectional Data
Notes: Cross sectional data does not provide us the ability to to study same values of one varaible for different values of another variable

***

### Heat Maps
Notes:Herw we plot a Heat map for gene data. The data set has close to 7000 observations but we plot this for 200 observations

```{r}
nci <- read.table("nci.tsv")
colnames(nci) <- c(1:64)
```

```{r}
nci.long.samp <- melt(as.matrix(nci[1:200, ]))
names(nci.long.samp) <- c("gene", "case", "value")
head(nci.long.samp)

ggplot(aes(y = gene, x = case, fill = value),
  data = nci.long.samp) +
  geom_tile() +
  scale_fill_gradientn(colours = colorRampPalette(c("blue", "red"))(100))
```

***
